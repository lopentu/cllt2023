{
  "hash": "a9fdc7fd7fc34e54d6c2b2bcc20418f7",
  "result": {
    "markdown": "---\ntitle: \"LR: Inference + conditions\"\nsubtitle: \"STA 210 - Spring 2022\"\nauthor: \"Dr. Mine Çetinkaya-Rundel\"\nfooter: \"[sta210-s22.github.io/website](https://sta210-s22.github.io/website/)\"\nlogo: \"images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    transition: fade\n    slide-number: true\n    incremental: true \n    chalkboard: true\neditor: visual\nexecute:\n  freeze: auto\n  echo: true\n---\n\n\n\n# Welcome\n\n## Topics\n\n::: nonincremental\n-   Bulding predictive logistic regression models\n-   Sensitivity and specificity\n-   Making classification decisions\n:::\n\n## Computational setup\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(openintro)\nlibrary(knitr)\nlibrary(kableExtra)  # for table embellishments\nlibrary(Stat2Data)   # for empirical logit\n\n# set default theme and larger font size for ggplot2\nggplot2::theme_set(ggplot2::theme_minimal(base_size = 20))\n```\n:::\n\n# Data\n\n## Risk of coronary heart disease {.smaller}\n\nThis dataset is from an ongoing cardiovascular study on residents of the town of Framingham, Massachusetts.\nWe want to examine the relationship between various health characteristics and the risk of having heart disease.\n\n-   `high_risk`:\n\n    -   1: High risk of having heart disease in next 10 years\n    -   0: Not high risk of having heart disease in next 10 years\n\n-   `age`: Age at exam time (in years)\n\n-   `education`: 1 = Some High School, 2 = High School or GED, 3 = Some College or Vocational School, 4 = College\n\n-   `currentSmoker`: 0 = nonsmoker, 1 = smoker\n\n## Data prep\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nheart_disease <- read_csv(here::here(\"slides\", \"data/framingham.csv\")) %>%\n  select(age, education, TenYearCHD, totChol, currentSmoker) %>%\n  drop_na() %>%\n  mutate(\n    high_risk = as.factor(TenYearCHD),\n    education = as.factor(education),\n    currentSmoker = as.factor(currentSmoker)\n  )\n\nheart_disease\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 4,086 × 6\n     age education TenYearCHD totChol currentSmoker high_risk\n   <dbl> <fct>          <dbl>   <dbl> <fct>         <fct>    \n 1    39 4                  0     195 0             0        \n 2    46 2                  0     250 0             0        \n 3    48 1                  0     245 1             0        \n 4    61 3                  1     225 1             1        \n 5    46 3                  0     285 1             0        \n 6    43 2                  0     228 0             0        \n 7    63 1                  1     205 0             1        \n 8    45 2                  0     313 1             0        \n 9    52 1                  0     260 0             0        \n10    43 1                  0     225 1             0        \n# … with 4,076 more rows\n```\n:::\n:::\n\n# Inference for a model\n\n## Modeling risk of coronary heart disease\n\nFrom age and education:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrisk_fit <- logistic_reg() %>%\n  set_engine(\"glm\") %>%\n  fit(high_risk ~ age + education, \n      data = heart_disease, family = \"binomial\")\n```\n:::\n\n## Model output {.smaller}\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntidy(risk_fit, conf.int = TRUE) %>% \n  kable(format = \"markdown\", digits = 3)\n```\n\n::: {.cell-output-display}\n|term        | estimate| std.error| statistic| p.value| conf.low| conf.high|\n|:-----------|--------:|---------:|---------:|-------:|--------:|---------:|\n|(Intercept) |   -5.508|     0.311|   -17.692|   0.000|   -6.125|    -4.904|\n|age         |    0.076|     0.006|    13.648|   0.000|    0.065|     0.087|\n|education2  |   -0.245|     0.113|    -2.172|   0.030|   -0.469|    -0.026|\n|education3  |   -0.236|     0.135|    -1.753|   0.080|   -0.504|     0.024|\n|education4  |   -0.024|     0.150|    -0.161|   0.872|   -0.323|     0.264|\n:::\n:::\n\n$$\n\\small{\\log\\Big(\\frac{\\hat{\\pi}}{1-\\hat{\\pi}}\\Big) = -5.385 + 0.073 ~ \\text{age} - 0.242 ~ \\text{ed2} - 0.235 ~ \\text{ed3} - 0.020 ~ \\text{ed4}}\n$$\n\n## Hypothesis test for $\\beta_j$\n\n**Hypotheses:** $H_0: \\beta_j = 0 \\hspace{2mm} \\text{ vs } \\hspace{2mm} H_a: \\beta_j \\neq 0$\n\n. . .\n\n**Test Statistic:** $$z = \\frac{\\hat{\\beta}_j - 0}{SE_{\\hat{\\beta}_j}}$$\n\n. . .\n\n**P-value:** $P(|Z| > |z|)$, where $Z \\sim N(0, 1)$, the Standard Normal distribution\n\n## Confidence interval for $\\beta_j$\n\nWe can calculate the .vocab\\[C% confidence interval\\] for $\\beta_j$ as the following:\n\n$$\n\\Large{\\hat{\\beta}_j \\pm z^* SE_{\\hat{\\beta}_j}}\n$$\n\nwhere $z^*$ is calculated from the $N(0,1)$ distribution\n\n. . .\n\nThis is an interval for the change in the log-odds for every one unit increase in $x_j$.\n\n## Interpretation in terms of the odds\n\nThe change in **odds** for every one unit increase in $x_j$.\n\n$$\n\\Large{e^{\\hat{\\beta}_j \\pm z^* SE_{\\hat{\\beta}_j}}}\n$$\n\n. . .\n\n**Interpretation:** We are $C\\%$ confident that for every one unit increase in $x_j$, the odds multiply by a factor of $e^{\\hat{\\beta}_j - z^* SE_{\\hat{\\beta}_j}}$ to $e^{\\hat{\\beta}_j + z^* SE_{\\hat{\\beta}_j}}$, holding all else constant.\n\n## Coefficient for `age` {.smaller}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> conf.low </th>\n   <th style=\"text-align:right;\"> conf.high </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -5.508 </td>\n   <td style=\"text-align:right;\"> 0.311 </td>\n   <td style=\"text-align:right;\"> -17.692 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> -6.125 </td>\n   <td style=\"text-align:right;\"> -4.904 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: #D9E3E4 !important;\"> age </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.076 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.006 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 13.648 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.000 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.065 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.087 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education2 </td>\n   <td style=\"text-align:right;\"> -0.245 </td>\n   <td style=\"text-align:right;\"> 0.113 </td>\n   <td style=\"text-align:right;\"> -2.172 </td>\n   <td style=\"text-align:right;\"> 0.030 </td>\n   <td style=\"text-align:right;\"> -0.469 </td>\n   <td style=\"text-align:right;\"> -0.026 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education3 </td>\n   <td style=\"text-align:right;\"> -0.236 </td>\n   <td style=\"text-align:right;\"> 0.135 </td>\n   <td style=\"text-align:right;\"> -1.753 </td>\n   <td style=\"text-align:right;\"> 0.080 </td>\n   <td style=\"text-align:right;\"> -0.504 </td>\n   <td style=\"text-align:right;\"> 0.024 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education4 </td>\n   <td style=\"text-align:right;\"> -0.024 </td>\n   <td style=\"text-align:right;\"> 0.150 </td>\n   <td style=\"text-align:right;\"> -0.161 </td>\n   <td style=\"text-align:right;\"> 0.872 </td>\n   <td style=\"text-align:right;\"> -0.323 </td>\n   <td style=\"text-align:right;\"> 0.264 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n. . .\n\n**Hypotheses:**\n\n$$\nH_0: \\beta_{1} = 0 \\hspace{2mm} \\text{ vs } \\hspace{2mm} H_a: \\beta_{1} \\neq 0\n$$\n\n## Coefficient for `age` {.smaller}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> conf.low </th>\n   <th style=\"text-align:right;\"> conf.high </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -5.508 </td>\n   <td style=\"text-align:right;\"> 0.311 </td>\n   <td style=\"text-align:right;\"> -17.692 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> -6.125 </td>\n   <td style=\"text-align:right;\"> -4.904 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: #D9E3E4 !important;\"> age </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.076 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.006 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 13.648 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.000 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.065 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.087 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education2 </td>\n   <td style=\"text-align:right;\"> -0.245 </td>\n   <td style=\"text-align:right;\"> 0.113 </td>\n   <td style=\"text-align:right;\"> -2.172 </td>\n   <td style=\"text-align:right;\"> 0.030 </td>\n   <td style=\"text-align:right;\"> -0.469 </td>\n   <td style=\"text-align:right;\"> -0.026 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education3 </td>\n   <td style=\"text-align:right;\"> -0.236 </td>\n   <td style=\"text-align:right;\"> 0.135 </td>\n   <td style=\"text-align:right;\"> -1.753 </td>\n   <td style=\"text-align:right;\"> 0.080 </td>\n   <td style=\"text-align:right;\"> -0.504 </td>\n   <td style=\"text-align:right;\"> 0.024 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education4 </td>\n   <td style=\"text-align:right;\"> -0.024 </td>\n   <td style=\"text-align:right;\"> 0.150 </td>\n   <td style=\"text-align:right;\"> -0.161 </td>\n   <td style=\"text-align:right;\"> 0.872 </td>\n   <td style=\"text-align:right;\"> -0.323 </td>\n   <td style=\"text-align:right;\"> 0.264 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n**Test statistic:**\n\n$$\nz = \\frac{0.0733 - 0}{0.00547} = 13.4\n$$\n\n## Coefficient for `age` {.smaller}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> conf.low </th>\n   <th style=\"text-align:right;\"> conf.high </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -5.508 </td>\n   <td style=\"text-align:right;\"> 0.311 </td>\n   <td style=\"text-align:right;\"> -17.692 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> -6.125 </td>\n   <td style=\"text-align:right;\"> -4.904 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: #D9E3E4 !important;\"> age </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.076 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.006 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 13.648 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.000 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.065 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.087 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education2 </td>\n   <td style=\"text-align:right;\"> -0.245 </td>\n   <td style=\"text-align:right;\"> 0.113 </td>\n   <td style=\"text-align:right;\"> -2.172 </td>\n   <td style=\"text-align:right;\"> 0.030 </td>\n   <td style=\"text-align:right;\"> -0.469 </td>\n   <td style=\"text-align:right;\"> -0.026 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education3 </td>\n   <td style=\"text-align:right;\"> -0.236 </td>\n   <td style=\"text-align:right;\"> 0.135 </td>\n   <td style=\"text-align:right;\"> -1.753 </td>\n   <td style=\"text-align:right;\"> 0.080 </td>\n   <td style=\"text-align:right;\"> -0.504 </td>\n   <td style=\"text-align:right;\"> 0.024 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education4 </td>\n   <td style=\"text-align:right;\"> -0.024 </td>\n   <td style=\"text-align:right;\"> 0.150 </td>\n   <td style=\"text-align:right;\"> -0.161 </td>\n   <td style=\"text-align:right;\"> 0.872 </td>\n   <td style=\"text-align:right;\"> -0.323 </td>\n   <td style=\"text-align:right;\"> 0.264 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n**P-value:**\n\n$$\nP(|Z| > |13.4|) \\approx 0\n$$\n\n. . .\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n2 * pnorm(13.4,lower.tail = FALSE)\n```\n\n::: {.cell-output-stdout}\n```\n[1] 6.046315e-41\n```\n:::\n:::\n\n## Coefficient for `age` {.smaller}\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> conf.low </th>\n   <th style=\"text-align:right;\"> conf.high </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -5.508 </td>\n   <td style=\"text-align:right;\"> 0.311 </td>\n   <td style=\"text-align:right;\"> -17.692 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> -6.125 </td>\n   <td style=\"text-align:right;\"> -4.904 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;background-color: #D9E3E4 !important;\"> age </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.076 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.006 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 13.648 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.000 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.065 </td>\n   <td style=\"text-align:right;background-color: #D9E3E4 !important;\"> 0.087 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education2 </td>\n   <td style=\"text-align:right;\"> -0.245 </td>\n   <td style=\"text-align:right;\"> 0.113 </td>\n   <td style=\"text-align:right;\"> -2.172 </td>\n   <td style=\"text-align:right;\"> 0.030 </td>\n   <td style=\"text-align:right;\"> -0.469 </td>\n   <td style=\"text-align:right;\"> -0.026 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education3 </td>\n   <td style=\"text-align:right;\"> -0.236 </td>\n   <td style=\"text-align:right;\"> 0.135 </td>\n   <td style=\"text-align:right;\"> -1.753 </td>\n   <td style=\"text-align:right;\"> 0.080 </td>\n   <td style=\"text-align:right;\"> -0.504 </td>\n   <td style=\"text-align:right;\"> 0.024 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education4 </td>\n   <td style=\"text-align:right;\"> -0.024 </td>\n   <td style=\"text-align:right;\"> 0.150 </td>\n   <td style=\"text-align:right;\"> -0.161 </td>\n   <td style=\"text-align:right;\"> 0.872 </td>\n   <td style=\"text-align:right;\"> -0.323 </td>\n   <td style=\"text-align:right;\"> 0.264 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n**Conclusion:**\n\nThe p-value is very small, so we reject $H_0$.\nThe data provide sufficient evidence that age is a statistically significant predictor of whether someone is high risk of having heart disease, *after accounting for education*.\n\n# Comparing models\n\n## Log likelihood\n\n$$\n\\log L = \\sum\\limits_{i=1}^n[y_i \\log(\\hat{\\pi}_i) + (1 - y_i)\\log(1 - \\hat{\\pi}_i)]\n$$\n\n-   Measure of how well the model fits the data\n\n-   Higher values of $\\log L$ are better\n\n-   **Deviance** = $-2 \\log L$\n\n    -   $-2 \\log L$ follows a $\\chi^2$ distribution with $n - p - 1$ degrees of freedom\n\n## Comparing nested models\n\n-   Suppose there are two models:\n\n    -   Reduced Model includes predictors $x_1, \\ldots, x_q$\n    -   Full Model includes predictors $x_1, \\ldots, x_q, x_{q+1}, \\ldots, x_p$\n\n-   We want to test the hypotheses\n\n    $$\n    \\begin{aligned}\n    H_0&: \\beta_{q+1} = \\dots = \\beta_p = 0 \\\\\n    H_A&: \\text{ at least 1 }\\beta_j \\text{ is not } 0\n    \\end{aligned}\n    $$\n\n-   To do so, we will use the **Drop-in-deviance test**, also known as the Nested Likelihood Ratio test\n\n## Drop-in-deviance test\n\n**Hypotheses:**\n\n$$\n\\begin{aligned}\nH_0&: \\beta_{q+1} = \\dots = \\beta_p = 0 \\\\\nH_A&: \\text{ at least 1 }\\beta_j \\text{ is not } 0\n\\end{aligned}\n$$\n\n. . .\n\n**Test Statistic:** $$G = (-2 \\log L_{reduced}) - (-2 \\log L_{full})$$\n\n. . .\n\n**P-value:** $P(\\chi^2 > G)$, calculated using a $\\chi^2$ distribution with degrees of freedom equal to the difference in the number of parameters in the full and reduced models\n\n## $\\chi^2$ distribution\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](lec-22_files/figure-revealjs/unnamed-chunk-11-1.png){fig-align='center' width=90%}\n:::\n:::\n\n## Model with age and education {.smaller}\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: question\nShould we add `currentSmoker` to this model?\n:::\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> conf.low </th>\n   <th style=\"text-align:right;\"> conf.high </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -5.508 </td>\n   <td style=\"text-align:right;\"> 0.311 </td>\n   <td style=\"text-align:right;\"> -17.692 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> -6.125 </td>\n   <td style=\"text-align:right;\"> -4.904 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> age </td>\n   <td style=\"text-align:right;\"> 0.076 </td>\n   <td style=\"text-align:right;\"> 0.006 </td>\n   <td style=\"text-align:right;\"> 13.648 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 0.065 </td>\n   <td style=\"text-align:right;\"> 0.087 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education2 </td>\n   <td style=\"text-align:right;\"> -0.245 </td>\n   <td style=\"text-align:right;\"> 0.113 </td>\n   <td style=\"text-align:right;\"> -2.172 </td>\n   <td style=\"text-align:right;\"> 0.030 </td>\n   <td style=\"text-align:right;\"> -0.469 </td>\n   <td style=\"text-align:right;\"> -0.026 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education3 </td>\n   <td style=\"text-align:right;\"> -0.236 </td>\n   <td style=\"text-align:right;\"> 0.135 </td>\n   <td style=\"text-align:right;\"> -1.753 </td>\n   <td style=\"text-align:right;\"> 0.080 </td>\n   <td style=\"text-align:right;\"> -0.504 </td>\n   <td style=\"text-align:right;\"> 0.024 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> education4 </td>\n   <td style=\"text-align:right;\"> -0.024 </td>\n   <td style=\"text-align:right;\"> 0.150 </td>\n   <td style=\"text-align:right;\"> -0.161 </td>\n   <td style=\"text-align:right;\"> 0.872 </td>\n   <td style=\"text-align:right;\"> -0.323 </td>\n   <td style=\"text-align:right;\"> 0.264 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n## Should we add `currentSmoker` to the model?\n\nFirst model, reduced:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrisk_fit_reduced <- logistic_reg() %>%\n  set_engine(\"glm\") %>%\n  fit(high_risk ~ age + education, \n      data = heart_disease, family = \"binomial\")\n```\n:::\n\n<br>\n\nSecond model, full:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-line-numbers=\"2\"}\nrisk_fit_full <- logistic_reg() %>%\n  set_engine(\"glm\") %>%\n  fit(high_risk ~ age + education + currentSmoker, \n      data = heart_disease, family = \"binomial\")\n```\n:::\n\n## Should we add `currentSmoker` to the model?\n\nCalculate deviance for each model:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(dev_reduced <- glance(risk_fit_reduced)$deviance)\n```\n\n::: {.cell-output-stdout}\n```\n[1] 3244.187\n```\n:::\n\n```{.r .cell-code}\n(dev_full <- glance(risk_fit_full)$deviance)\n```\n\n::: {.cell-output-stdout}\n```\n[1] 3221.901\n```\n:::\n:::\n\n. . .\n\nDrop-in-deviance test statistic:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n(test_stat <- dev_reduced - dev_full)\n```\n\n::: {.cell-output-stdout}\n```\n[1] 22.2863\n```\n:::\n:::\n\n## Should we add `currentSmoker` to the model?\n\nCalculate the p-value using a `pchisq()`, with degrees of freedom equal to the number of new model terms in the second model:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npchisq(test_stat, 1, lower.tail = FALSE) \n```\n\n::: {.cell-output-stdout}\n```\n[1] 2.348761e-06\n```\n:::\n:::\n\n. . .\n\n**Conclusion:** The p-value is very small, so we reject $H_0$.\nThe data provide sufficient evidence that the coefficient of `currentSmoker` is not equal to 0.\nTherefore, we should add it to the model.\n\n## Drop-in-Deviance test in R\n\n-   We can use the **`anova`** function to conduct this test\n\n-   Add **`test = \"Chisq\"`** to conduct the drop-in-deviance test\n\n. . .\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nanova(risk_fit_reduced$fit, risk_fit_full$fit, test = \"Chisq\") %>%\n  tidy()\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 2 × 5\n  Resid..Df Resid..Dev    df Deviance     p.value\n      <dbl>      <dbl> <dbl>    <dbl>       <dbl>\n1      4081      3244.    NA     NA   NA         \n2      4080      3222.     1     22.3  0.00000235\n```\n:::\n:::\n\n## Model selection\n\nUse AIC or BIC for model selection\n\n$$\n\\begin{align}\n&AIC = - 2 * \\log L - \\color{purple}{n\\log(n)}+ 2(p +1)\\\\[5pt]\n&BIC =- 2 * \\log L - \\color{purple}{n\\log(n)} + log(n)\\times(p+1)\n\\end{align}\n$$\n\n## AIC from the `glance()` function\n\nLet's look at the AIC for the model that includes `age`, `education`, and `currentSmoker`\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglance(risk_fit_full)$AIC\n```\n\n::: {.cell-output-stdout}\n```\n[1] 3233.901\n```\n:::\n:::\n\n. . .\n\n**Calculating AIC**\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n- 2 * glance(risk_fit_full)$logLik + 2 * (5 + 1)\n```\n\n::: {.cell-output-stdout}\n```\n[1] 3233.901\n```\n:::\n:::\n\n## Comparing the models using AIC\n\nLet's compare the full and reduced models using AIC.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglance(risk_fit_reduced)$AIC\n```\n\n::: {.cell-output-stdout}\n```\n[1] 3254.187\n```\n:::\n\n```{.r .cell-code}\nglance(risk_fit_full)$AIC\n```\n\n::: {.cell-output-stdout}\n```\n[1] 3233.901\n```\n:::\n:::\n\n::: question\nBased on AIC, which model would you choose?\n:::\n\n## Comparing the models using BIC\n\nLet's compare the full and reduced models using BIC\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglance(risk_fit_reduced)$BIC\n```\n\n::: {.cell-output-stdout}\n```\n[1] 3285.764\n```\n:::\n\n```{.r .cell-code}\nglance(risk_fit_full)$BIC\n```\n\n::: {.cell-output-stdout}\n```\n[1] 3271.793\n```\n:::\n:::\n\n::: question\nBased on BIC, which model would you choose?\n:::\n\n# Conditions\n\n## The model {.smaller}\n\nLet's predict `high_risk` from age, total cholesterol, and whether the patient is a current smoker:\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrisk_fit <- logistic_reg() %>%\n  set_engine(\"glm\") %>%\n  fit(high_risk ~ age + totChol + currentSmoker, \n      data = heart_disease, family = \"binomial\")\n\ntidy(risk_fit, conf.int = TRUE) %>% \n  kable(digits = 3)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table>\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> term </th>\n   <th style=\"text-align:right;\"> estimate </th>\n   <th style=\"text-align:right;\"> std.error </th>\n   <th style=\"text-align:right;\"> statistic </th>\n   <th style=\"text-align:right;\"> p.value </th>\n   <th style=\"text-align:right;\"> conf.low </th>\n   <th style=\"text-align:right;\"> conf.high </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> (Intercept) </td>\n   <td style=\"text-align:right;\"> -6.673 </td>\n   <td style=\"text-align:right;\"> 0.378 </td>\n   <td style=\"text-align:right;\"> -17.647 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> -7.423 </td>\n   <td style=\"text-align:right;\"> -5.940 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> age </td>\n   <td style=\"text-align:right;\"> 0.082 </td>\n   <td style=\"text-align:right;\"> 0.006 </td>\n   <td style=\"text-align:right;\"> 14.344 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 0.071 </td>\n   <td style=\"text-align:right;\"> 0.094 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> totChol </td>\n   <td style=\"text-align:right;\"> 0.002 </td>\n   <td style=\"text-align:right;\"> 0.001 </td>\n   <td style=\"text-align:right;\"> 1.940 </td>\n   <td style=\"text-align:right;\"> 0.052 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 0.004 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> currentSmoker1 </td>\n   <td style=\"text-align:right;\"> 0.443 </td>\n   <td style=\"text-align:right;\"> 0.094 </td>\n   <td style=\"text-align:right;\"> 4.733 </td>\n   <td style=\"text-align:right;\"> 0.000 </td>\n   <td style=\"text-align:right;\"> 0.260 </td>\n   <td style=\"text-align:right;\"> 0.627 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n## Conditions for logistic regression\n\n1.  **Linearity:** The log-odds have a linear relationship with the predictors.\n\n2.  **Randomness:** The data were obtained from a random process\n\n3.  **Independence:** The observations are independent from one another.\n\n## Empirical logit\n\nThe **empirical logit** is the log of the observed odds:\n\n$$\n\\text{logit}(\\hat{p}) = \\log\\Big(\\frac{\\hat{p}}{1 - \\hat{p}}\\Big) = \\log\\Big(\\frac{\\# \\text{Yes}}{\\# \\text{No}}\\Big)\n$$\n\n## Calculating empirical logit (categorical predictor)\n\nIf the predictor is categorical, we can calculate the empirical logit for each level of the predictor.\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nheart_disease %>%\n  count(currentSmoker, high_risk) %>%\n  group_by(currentSmoker) %>%\n  mutate(prop = n/sum(n)) %>%\n  filter(high_risk == \"1\") %>%\n  mutate(emp_logit = log(prop/(1-prop)))\n```\n\n::: {.cell-output-stdout}\n```\n# A tibble: 2 × 5\n# Groups:   currentSmoker [2]\n  currentSmoker high_risk     n  prop emp_logit\n  <fct>         <fct>     <int> <dbl>     <dbl>\n1 0             1           301 0.145     -1.77\n2 1             1           318 0.158     -1.67\n```\n:::\n:::\n\n## Calculating empirical logit (quantitative predictor)\n\n1.  Divide the range of the predictor into intervals with approximately equal number of cases.\n    (If you have enough observations, use 5 - 10 intervals.)\n\n2.  Calculate the mean value of the predictor in each interval.\n\n3.  Compute the empirical logit for each interval.\n\n. . .\n\nThen, create a plot of the empirical logit versus the mean value of the predictor in each interval.\n\n## Empirical logit plot in R (quantitative predictor)\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nemplogitplot1(high_risk ~ age, \n              data = heart_disease, \n              ngroups = 10)\n```\n\n::: {.cell-output-display}\n![](lec-22_files/figure-revealjs/unnamed-chunk-26-1.png){fig-align='center' width=90%}\n:::\n:::\n\n## Empirical logit plot in R (interactions)\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nemplogitplot2(high_risk ~ age + currentSmoker, data = heart_disease, \n              ngroups = 10, \n              putlegend = \"bottomright\")\n```\n\n::: {.cell-output-display}\n![](lec-22_files/figure-revealjs/unnamed-chunk-27-1.png){fig-align='center' width=90%}\n:::\n:::\n\n## Checking linearity\n\n::: columns\n::: {.column width=\"50%\"}\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nemplogitplot1(high_risk ~ age, \n              data = heart_disease, \n              ngroups = 10)\n```\n\n::: {.cell-output-display}\n![](lec-22_files/figure-revealjs/unnamed-chunk-28-1.png){fig-align='center' width=90%}\n:::\n:::\n:::\n\n::: {.column width=\"50%\"}\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nemplogitplot1(high_risk ~ totChol, \n              data = heart_disease, \n              ngroups = 10)\n```\n\n::: {.cell-output-display}\n![](lec-22_files/figure-revealjs/unnamed-chunk-29-1.png){fig-align='center' width=90%}\n:::\n:::\n:::\n:::\n\n. . .\n\n✅ The linearity condition is satisfied.\nThere is a linear relationship between the empirical logit and the predictor variables.\n\n## Checking randomness {.smaller}\n\nWe can check the randomness condition based on the context of the data and how the observations were collected.\n\n-   Was the sample randomly selected?\n-   If the sample was not randomly selected, ask whether there is reason to believe the observations in the sample differ systematically from the population of interest.\n\n. . .\n\n✅ The randomness condition is satisfied.\nWe do not have reason to believe that the participants in this study differ systematically from adults in the U.S. in regards to health characteristics and risk of heart disease.\n\n## Checking independence\n\n- We can check the independence condition based on the context of the data and how the observations were collected.\n- Independence is most often violated if the data were collected over time or there is a strong spatial relationship between the observations.\n\n. . .\n\n✅ The independence condition is satisfied.\nIt is reasonable to conclude that the participants' health characteristics are independent of one another.",
    "supporting": [
      "lec-22_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    function fireSlideChanged(previousSlide, currentSlide) {\n\n      // dispatch for htmlwidgets\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for reveal\n    if (window.Reveal) {\n      window.Reveal.addEventListener(\"slidechanged\", function(event) {\n        fireSlideChanged(event.previousSlide, event.currentSlide);\n      });\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}